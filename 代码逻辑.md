# ✅ **GLMB/LMB 目标跟踪系统：修改与演进总体总结**

以下总结了我们从初版到完整可视化、可评估版本的所有关键修改步骤。

---

# 🔧 **一、数据生成与仿真模块（data\_gen / dynamic\_sim）**

### 1\. **目标出现时刻建模错误 → 修复 B 出生逻辑**

**问题**：

-   B 的真值虽然存在，但在动画/跟踪中“看不到 B”，轨迹为空。
    

**原因**：

-   `dynamic_sim` 把 B 视为“每帧动态判断”，而真实的 B 出生逻辑应该是**确定一个 first\_B\_idx**，只在那一帧加入滤波器。
    

**修改**：

-   添加 `first_B_idx` 计算（从真值中查找非 NaN 时刻）。
    
-   在 B 出生帧：**加入 B 但不 step()**（与 GLMB 结构一致）。
    
-   下一帧起正常 step()。
    

**结果**：  
✔ B 在动画和数值指标中真正出现、被跟踪。  
✔ 生命周期与真值一致。

---

### 2\. **画图轨迹线缩进错误 → 修复**

由于缩进错位，一段轨迹线初始化代码被错误嵌套，导致图像内元素不刷新。

**修改**：  
☑ 修正缩进，统一成：

```python
est_lines = {
   'A': ax.plot(...),
   'B': ax.plot(...),
}
```

---

# 🔧 **二、跟踪器调用逻辑（main.py / dynamic\_sim.py）**

### 1\. **GLMB 初始化必须与真实场景一致**

你要求 **main 与动态图 dynamic\_sim 完全一致**。

**修复动作**：

-   A 在第 0 帧加入
    
-   B 在 first\_B\_idx 帧加入
    
-   出生帧不 step()，仅添加目标并取当前状态
    
-   其它帧均正常 `tracker.step(meas_k, t)`
    

**结果**：  
✔ 仿真与数值计算一致，不再出现“动画看到两个目标，但 main 结果显示只有一个”的不一致。

---

# 🔧 **三、基础指标体系（metrics.py）修复与强化**

### 1\. **新增：逐帧 OSPA(t)**

原来只有平均 OSPA，现在加入曲线：

✔ 能观察 Jam 区进入/退出时性能变化  
✔ 能看漏检/假检导致的突刺

---

### 2\. **新增：逐帧 RMSE(t)**

用于观察：

-   B 出生前后误差
    
-   遮蔽区误差
    
-   假警干扰波动
    

---

### 3\. **新增：逐帧 Cardinality 曲线**

包括：

-   true\_counts(t)
    
-   est\_counts(t)
    
-   errors(t)
    

✔ 能清楚看到 GLMB 是否产生假 track  
✔ Jam 区是否升高假目标数量

---

### 4\. **新增：检测召回率（Recall over time）**

给每个目标（A/B）：

-   逐帧是否成功估计
    
-   累积召回率曲线
    

✔ 用来验证滤波器稳定性  
✔ 判断劳动阶段是否漏检

---

### 5\. **新增：ID Assignment 序列 build\_id\_assignment\_series()**

这是后面混淆矩阵、ID 时间轴图的基础。

✔ 每帧每个 track 分配到真实 A/B/None  
✔ 编解码器行为可查看

---

# 🔧 **四、高级指标体系（Confusion Matrix）**

### 1\. **引入多目标跟踪领域专用的混淆矩阵**

不同于分类任务，这里的混淆矩阵定义为：

| True \\ Est | A | B | None |
| --- | --- | --- | --- |
| A | TP | A→B 混淆 | FN |
| B | B→A 混淆 | TP | FN |
| Clutter | FP→A | FP→B | — |

**修改**：

-   添加 compute\_confusion\_matrix()
    
-   添加 plot\_confusion\_matrix()
    
-   main.py 自动生成 confusion\_matrix.png
    

**效果**：  
✔ 完成一个“识别视角”的质量评估  
✔ 可量化 GLMB 的 **ID-stability / cross-assignment** 性能

这是科研论文级别的必要内容。

---

# 🔧 **五、绘图体系（plot.py）全面升级**

新增了以下可视化模块：

### 1\. 轨迹总览图 `traj_overview.png`

-   真值轨迹：A、B
    
-   估计轨迹：A\_est、B\_est
    
-   判断整体跟踪精度
    

### 2\. 性能三联图 `metrics_timeseries.png`

-   OSPA vs time
    
-   RMSE vs time
    
-   Cardinality vs time
    

### 3\. ID 时间轴图 `id_timeline.png`

-   每个 label 在不同时刻属于哪个真值
    
-   清晰展示 GLMB 是否 ID-switching
    

### 4\. 检测召回率曲线 `recall_timeseries.png`

-   A、B 的检测召回率趋势
    

### 5\. 量测点云快照图 `meas_step060.png`

-   不同雷达
    
-   杂波 vs 真实量测
    
-   真值 / 估计位置
    

全部自动保存，不弹窗。

---

# 🔧 **六、main.py 最终整合**

我们对 main.py 进行了结构化升级：

1.  跟踪逻辑与 dynamic\_sim 完全一致
    
2.  自动记录所有中间结果
    
3.  自动计算所有指标
    
4.  自动绘制所有图
    
5.  自动打印所有 summary 指标
    

最终 main.py 成为 **完整的 GLMB 评估与可视化 pipeline**。

---

# 🎯 **七、最终系统能力（重要总结）**

你的系统现在是：

✔ **真实 + 多雷达 + 杂波 + Jam 区干扰仿真**  
✔ **GLMB/LMB 多目标跟踪核心算法（完整）**  
✔ **多指标评估体系**

-   RMSE（总体+逐帧）
    
-   Cardinality error（总体+逐帧）
    
-   OSPA（总体+逐帧）
    
-   Recall 曲线
    
-   Confusion Matrix  
    ✔ **可视化体系（全部保存）**
    
-   轨迹总览图
    
-   性能三联图
    
-   ID 时间轴图
    
-   混淆矩阵图
    
-   量测点云快照  
    ✔ **动画（dynamic\_sim）**  
    ✔ **统一一致的出生逻辑（A/B）**
    